选题：选项 1 - 智慧城市交通 (Smart City Traffic)

学生： HU Ziyuan

小组成员： LI Zonghan, GAO Yuan

1. 问题陈述与动机 (Problem Statement and Motivation)

城市交叉路口是交通流动性和安全性的重要瓶颈。市政当局部署了成百上千的联网交通摄像头，这些摄像头持续捕捉异构的视觉流，其内容随时间、天气和交通事件而变化。该基础设施的核心任务包括：实时车辆和行人检测；用于自适应信号控制的排队长度和转向运动估计；以及作为可选扩展或未来工作的事故/未遂事故检测。当前的部署通常要么将所有原始视频流式传输到中央数据中心，这既昂贵、缓慢又涉及隐私敏感问题；要么在边缘运行孤立的启发式算法，准确性有限且缺乏跨站点学习机制。

联邦学习 (Federated Learning, FL) 提供了一种引人注目的替代方案，能够在无需将原始视频导出摄像头的情况下进行协作模型训练。本地模型利用最近的帧在设备上进行训练，并仅将模型更新传输到聚合器。这种方法大幅降低了带宽消耗，从设计上尊重隐私，并允许模型持续适应特定摄像头的领域，同时通过学习全市范围的数据多样性来提高全局性能。与集中式学习相比，FL 避免了存储个人身份图像的法律和运营负担，并且天生具有适应此类部署中常见的断续连接的能力。

一个稳健的联邦边缘智能系统可以将分析延迟从秒级降低到数十毫秒，从而实现减少交通延误和排放的自适应信号配时。它还可以通过快速、自动化的事故检测显著改善“零伤亡愿景” (Vision-Zero) 计划。该架构可推广到其他任务，如自行车计数和行人安全分析，无需集中摄取视频即可扩展到数千个交叉路口。

本项目的目标参与者是模拟的 IP 交通摄像头及其关联的边缘计算节点，代表交叉路口和主干道的安装设施。系统必须在多个模拟约束下运行。这些约束包括异构的计算能力、可变的上行链路带宽以及严格的隐私要求。此外，模拟将通过包含代表眩光、雨和雪的数据切片以及有限的设备存储空间来模拟环境变化。

2. 系统架构设计 (System Architecture Design)

我们提出了一种分层联邦拓扑结构。在基础层，代表模拟摄像头+边缘节点的 客户端 (Clients) 执行本地训练并贡献模型增量 (deltas)。这些更新首先发送到 区域聚合器 (District Aggregators)，它们模拟边缘网关并执行第一阶段聚合以减少回传流量。最后，位于市政数据中心的中央 城市协调器 (City Coordinator) 完成最终聚合，管理模型选择并编排部署。

高层架构如下：

边缘节点 (底层): $$
摄像头 + 边缘盒子

$$执行本地训练。$$

通信: 基础通信使用 gRPC/HTTP，在实验中模拟 QUIC + TLS 1.3 的开销与延迟。

聚合层:

区域聚合器: 中间聚合以减少带宽。

城市协调器: 鲁棒聚合、模型注册表、金丝雀发布 (Canary Rollout)、监控。

部署: 签名后的模型发布版本被发送回边缘节点。

在我们的模拟中，设备类型将被建模以反映现实世界的多样性。摄像头将被模拟为生成 1080p/30fps H.264/H.265 流。连接的边缘计算节点将被分配不同的性能特征以代表硬件异构性。这种异构性将通过多种机制处理，包括客户端自适应本地轮次 (local epochs)、FedProx 风格的正则化、模拟混合精度训练、动态批量大小以及可选的每轮部分参与。

系统将在模拟环境中使用 gRPC 进行基础通信。为了模拟真实环境，我们将在实验数据中增加额外的延迟和带宽开销来代表 QUIC 和 TLS 1.3 的影响。联邦调度是基于轮次的，具有客户端采样和落后者容忍机制，时间窗口设计为避开模拟的高峰时段。数据流过程如下：模拟的帧捕获后进行隐私处理（脱敏）。帧在本地训练前被缓存（模拟）。生成的加密更新（模拟加密开销）发送到区域聚合器，然后是城市聚合器。经过模型验证后，签名的 OTA 模型版本将被部署回模拟设备。

实现范围说明 (Implementation Scope Clarification)

为了适应学生项目的开发周期并聚焦于联邦学习核心逻辑，我们将对部分生产级特性进行模拟实现：

传输层： 我们将在模拟环境中使用标准 gRPC（不强制实现复杂的 QUIC/TLS 协议栈），主要在实验中统计加密握手和安全传输带来的“理论带宽占用”和延迟开销。

安全聚合与签名： 将首先以“逻辑流程 + 开销建模”的方式实现（即确保架构中包含该步骤），验证系统流程的完整性，而不从零编写底层的同态加密或多方计算协议。

硬件模拟： 能源感知和提前退出（early exit）机制将主要通过时间延迟和计算量 (FLOPs) 等 Proxy 指标进行模拟，而不接入真实的硬件功耗传感器。

我们的架构包含几个关键的隐私和安全决策。我们将实施 安全聚合 (Secure Aggregation) 以确保协调器永远无法看到明文的个人更新。将应用 差分隐私 (DP-SGD)，涉及每个样本的梯度裁剪和校准噪声，以限制信息泄漏。在任何存储之前，都会执行基于设备的脱敏（如模糊处理）。系统还将使用认证和签名，客户端验证模型签名，协调器验证客户端密钥。我们的威胁模型假设存在“诚实但好奇” (honest-but-curious) 的协调器、试图进行中毒攻击的潜在拜占庭客户端，以及网络对手，这些都将通过 TLS 和更新验证来缓解。

3. 技术方案 (Technical Approach)

主要的学习任务包括车辆/行人检测与跟踪、基于跟踪对象的排队长度回归，以及作为可选/未来工作的事故/未遂事故检测。

模型骨干 (Model Backbone): 候选模型为轻量级检测器，选用 YOLO11系列 (如 YOLO11n) 或 MobileNet-SSD 风格架构，这些模型将从离线训练的大型教师模型中蒸馏而来。系统将输出每帧检测结果、短时计数和滚动排队估计。

联邦算法 (Federated Algorithm): 基础算法将是带有部分客户端参与、客户端自适应本地轮次和动量的 FedAvg。为了处理异构性，将添加 FedProx 惩罚项以稳定更新。

鲁棒性 (Robustness): 为了防御异常值和中毒攻击，城市协调器将采用坐标中位数 (coordinate-wise median) 或修剪均值 (trimmed mean) 聚合，并辅以更新范数裁剪。分层特性通过让区域聚合器在转发给城市级鲁棒聚合器之前执行加权平均来解决。

隐私 (Privacy): 我们设定了两层目标：

实现层面： 我们将实施基于 mini-batch 的梯度裁剪与噪声注入，以近似 DP-SGD 的行为。

评估层面： 我们将利用现有的 DP accountant（如引用 Opacus 文献）来计算隐私预算。对于成员推断防御，我们不强制实现完整的深度攻击，而是可以使用“训练集与测试集损失差距 (train vs test loss gap)”作为隐私泄露的代理 (proxy) 指标。这辅以聚合器边界处的基于掩码的安全聚合协议（逻辑模拟）和确定性的设备端脱敏。

优化模拟 (Optimization Simulation): 我们将模拟硬件感知优化的效果。这包括评估用于 INT8 部署的量化感知训练 (QAT) 以及剪枝对准确性和模拟延迟的影响。我们还将模拟动态分辨率和提前退出 (early-exit) 头，以在不同的模拟负载下满足每帧延迟预算。最后，将模拟能源感知调度。

流水线涉及通过蒸馏训练学生模型并导出为 ONNX。我们将模拟针对 INT8 的每种客户端类型的校准。部署过程将是一个模拟的金丝雀发布，新模型将被推送到 5-10% 的模拟客户端。晋升或回滚将基于模拟的 mAP 和延迟等性能指标。

高级特性选择 (Advanced Features Selection):
团队将从以下列表中实现两到三个高级特性：

带有性化头的概念漂移检测 (Concept-drift detection)。

通信高效更新 (Communication-efficient updates)，使用带有误差反馈的 top-k 稀疏化和 8-bit 量化增量。

对抗/中毒防御 (Adversarial/poisoning defenses)（异常评分，余弦相似度）。

4. 实施计划 (Implementation Plan)

本项目将完全在模拟环境中进行。我们将在一台或多台工作站上使用 Docker/Compose 模拟所有组件。每个 Docker 容器将代表一个独立的边缘节点（客户端）。我们将利用 UA-DETRAC（专注于路口车辆检测）和 VisDrone（涵盖多城市、多视角及极端天气）数据集来构建模拟环境。UA-DETRAC 将用于模拟固定路口的主力摄像头，而 VisDrone 将用于模拟具有不同视角和高度的异构边缘节点，从而天然形成 Non-IID 数据分布。此外，我们将 AI City Challenge 和 MIO-TCD 作为备选数据集，用于在大规模扩展性测试中增加数据多样性。

技术栈包括用于模型开发的 Python 和 PyTorch；用于联邦编排及自定义分层插件的 Flower 或 FedML；以及用于推理流水线的 ONNX Runtime 和 OpenCV。通信和运维将利用 gRPC, QUIC, TLS, Docker 和 Compose。监控将通过 Prometheus 和 Grafana 提供，CI/CD 由 GitHub Actions 管理。

任务执行列表 (Task Execution List):

我们将采用技术模块驱动的开发模式，重点攻克以下核心工程难题：

第一阶段：基础设施与基准 (Infrastructure & Baseline)

数据准备 (Data Setup):

直接利用开源资源： 从 Roboflow 或 Kaggle 下载已预处理为 YOLO 格式的 UA-DETRAC（采样版）和 VisDrone 数据集，跳过繁琐的 XML 解析与坐标转换工作。

Non-IID 索引构建: 编写轻量级 Python 脚本，基于文件名或随机种子生成 client_distribution.json，将数据逻辑划分为不同的客户端子集（模拟不同路口和天气）。

基准模型:

在合并数据集上训练 YOLO11n，获得 mAP 上限。

导出 ONNX 并测试 onnxruntime 在 CPU/GPU 环境下的推理一致性。

第二阶段：核心系统开发 (Core System Development)

此阶段是工程量最大、Bug 最多的部分，重点解决分布式通信与模型收敛问题。

$$架构$$

 分布式容器编排:

gRPC 协议定义: 编写 .proto 文件，定义 FitRequest (参数下发) 和 FitResponse (参数上传)。关键点： 解决 gRPC 默认 4MB 消息限制，配置 MaxRecvMsgSize 以支持 YOLO 参数传输。

序列化中间件: 实现 PyTorch state_dict <-> numpy <-> protobuf bytes 的高效转换与压缩工具。

$$算法$$

 异构联邦训练:

实现 Client 端本地训练循环，集成 FedProx 的近端项 (Proximal Term) 损失函数 $L + \frac{\mu}{2}||w-w_{global}||^2$。

调试 mu 超参数，解决 Non-IID 数据（如仅有夜间数据的客户端）导致的 Loss 震荡问题。

$$隐私$$

 差分隐私实现:

实现基于 Opacus 逻辑的 Per-sample Gradient Clipping（样本级梯度裁剪），而非简单的 Batch 级裁剪。

实现高斯噪声注入机制，并验证在不同噪声水平 ($\sigma$) 下模型的 mAP 衰减曲线。

第三阶段：高级特性与集成 (Advanced Features & Integration)

此阶段重点在于优化通信效率与增强系统安全性，需处理多模块集成带来的误差叠加问题。

通信优化 (Quantization):

实现 8-bit 随机舍入量化 (Stochastic Rounding): 在 Client 上传前计算每层参数的 scale 和 zero_point，将 float32 压缩为 int8。

关键点： 处理 Batch Normalization 层的敏感性，必要时对敏感层保留全精度传输。

安全防御 (Robust Aggregation):

攻击模拟: 开发 MaliciousClient 类，实现“标签翻转 (Label Flipping)”或“噪声干扰”攻击。

防御实现: 在 Coordinator 端实现 Trimmed Mean (修剪均值) 或 Krum 聚合算法，替代标准的 Weighted Average，并在攻击存在时验证其鲁棒性。

系统集成与联调:

误差叠加测试: 验证同时开启 "DP噪声" + "量化误差" + "Non-IID数据" 时，模型是否仍能收敛。这是项目中最耗时的调优环节。

第四阶段：评估与交付 (串行 - 收尾)

全面评估 (Evaluation): 执行大规模可扩展性测试 (128 clients) 与消融实验 (Ablation Studies)。

交付物制作: 生成实验图表，撰写最终报告与演示 PPT。

风险 (Risks):

标签稀缺 (通过自举/蒸馏缓解)。

落后者/断网 (通过部分参与/截止时间缓解)。

准确性与隐私的权衡 (通过对 epsilon 进行网格搜索调整)。

模型膨胀/延迟 (通过剪枝/INT8 缓解)。

中毒攻击 (通过鲁棒聚合缓解)。

5. 评估方法 (Evaluation Methodology)

指标: 检测/跟踪 (mAP@{0.5, 0.5:0.95}, IDF1), 交通 KPI (排队长度 MAE, 转向计数), 效率 (模拟延迟 <33 ms, 上传字节数), 隐私 (epsilon, delta 预算, （可选）基于简化成员推断攻击或 train-test gap 的隐私泄露 proxy 指标), 安全性 (对中毒的抵抗力)。

基线: 集中式上限 (Centralized upper bound), 仅本地 (Local-only), 标准 FL (FedAvg, FedAvg+DP, FedProx+DP)。

可扩展性: 扫描客户端数量 (8-128), 可用性 (60-100%), 和带宽 (0.5-10 Mbps)。